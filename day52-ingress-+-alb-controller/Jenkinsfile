pipeline {
  agent { label 'docker-agent' }
  options { timestamps(); ansiColor('xterm'); timeout(time: 20, unit: 'MINUTES') }
  parameters { choice(name: 'ENV_NAME', choices: ['staging','prod']); string(name: 'KUBE_CONTEXT', defaultValue: '') }
  environment { SCRIPTS = 'day52-ingress-alb-controller/scripts' }
  stages { stage('Checkout'){ steps { checkout scm } } stage('Select Context'){ when { expression { return params.KUBE_CONTEXT?.trim() } } steps { sh 'kubectl config use-context "${KUBE_CONTEXT}"' } } stage('Deploy'){ steps { sh 'bash ${SCRIPTS}/deploy.sh ${ENV_NAME}' } } stage('Rollout'){ steps { sh 'bash ${SCRIPTS}/rollout_status.sh ${ENV_NAME}' } } stage('Get Host'){ steps { sh 'bash ${SCRIPTS}/get_hostname.sh ${ENV_NAME}' } } }
  post { success { echo '✅ Ingress deployed' } failure { echo '❌ Ingress failed' } always { cleanWs() } }
}
